#!/usr/bin/env node

/* Third-party Modules */
var mkdirp = require('mkdirp'),
    pkg = require('../package.json'),
    version = pkg.version,
    os = require('os'),
    fs = require('fs'),
    path = require('path'),
    exec = require('child_process').exec,
    _ = require('lodash');

/* Local modules */
var commands = require('./commands.js');

/* Global vars */
var validCommands = {
  "new": "n",
  "install": "i",
  "dev": "d",
  "prod": "p",
  "help": "h"
};

// List of arguments passed in
var args = process.argv.slice(2);

// Determine which command is being executed
var command = (function () {
  // Substitute shortcut commands for the full version
  var supposedCommand = _.invert(validCommands)[ args[0] ] || args[0];

  // Replace unknown commands with 'help'
  if ( !_(validCommands).has(supposedCommand) ) {
    if (supposedCommand) console.log('Unrecognized command: ' + supposedCommand + '\n');
    return "help";
  }
  return supposedCommand;
})();

if (command == 'new' && args[1] && args[1][0] != '-') {
  commands.createNewApp(args[1]);
  return;
}

if ( _(['dev', 'prod']).contains(command) ) {
  commands.startServer(command);
  return;
}

if (command == 'install') {
  process.chdir('back');
  exec('npm install', function (err, stdout) {
    console.log(stdout);
    if (err) throw err;
  });
}

commands.showHelp(args[1]);
